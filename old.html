<!DOCTYPE html>
<html>
<head>
  <title>Shoot'em Up</title>
  <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
  <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
  <script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body onload="init()">

  <canvas id="demoCanvas" width="960" height="750">
  </canvas>


  <script type="text/javascript">
    function init(){
        var stage = new createjs.Stage("demoCanvas");
        var triangle = new createjs.Shape();
        triangle.graphics.beginFill('red').moveTo(0, 120).lineTo(120, 120).lineTo(60, 60).lineTo(0, 120);
        stage.addChild(triangle);
        triangle.x = 400;
        triangle.y = 600;
        stage.update();

        var circles = [];
        var ennemies = 7;
        for(var i=0; i<ennemies; i++){
            circles[i] = new createjs.Shape();
            var m = 60;
            circles[i].graphics.beginFill("DeepSkyBlue").drawCircle(0, 0, 50);
            circles[i].x = (i * 140) + m;
            circles[i].y = 60;
            stage.addChild(circles[i]);
            stage.update();
        }   

        var tile = new createjs.Shape();
        tile.graphics.beginFill('yellow');
        tile.graphics.drawRect(0, 0, 20, 90);
        tile.graphics.endFill();
        tile.x = 450;
        tile.y = 600;
        stage.addChild(tile);
        stage.update();
        
        createjs.Tween.get(tile, { loop: true })
        .to({ y: 0 }, 250, createjs.Ease.getPowInOut(4))
        .call(function(){
            console.log('end');
            for(var i=0, len = circles.length; i<len; i++){
                console.log('x : ' + circles[i].x + ' ' + (circles[i].x + 50));
                if( ((tile.x + 20) >= circles[i].x && (tile.x + 20) <= (circles[i].x + 50)) || ((tile.x + 20 + 40 ) >= circles[i].x && (tile.x + 20 + 40 ) <= (circles[i].x + 50)) ){
                    console.log("touched : " + i);
                    stage.removeChild(circles[i]);
                    stage.update();
                    circles.splice(i, 1);
                    console.log(circles.length);
                }
                if( circles.length == 0){
                    alert('You won !');
                }
            }
            console.log((tile.x + 20) + ' ' + (tile.x + 20 + 20));
        });
        createjs.Ticker.setFPS(60);
        createjs.Ticker.addEventListener("tick", stage);

        $(document).keydown(function(e){
            key = e.keyCode;
            if(key == 37 && triangle.x >= 50){
                console.log('left');
                move(triangle, 'left');
            }
            if(key == 39 && triangle.x <= 800){
                console.log('right');
                move(triangle, 'right');
            }
        });

        function move(element, way){
            if( way == 'left'){ 
                createjs.Tween.get(element)
                .to({x: element.x - 50}, 100, createjs.Ease.getPowInOut(1))
                createjs.Ticker.setFPS(60);
                createjs.Ticker.addEventListener("tick", stage);
                console.log(element.x);
                tile.x = triangle.x;
            }
            else{
                createjs.Tween.get(element)
                .to({x: element.x + 50}, 100, createjs.Ease.getPowInOut(4))
                createjs.Ticker.setFPS(60);
                createjs.Ticker.addEventListener("tick", stage);
                console.log(element.x);
                tile.x = triangle.x + 100;
            }   
        }

    }
</script>
</body>
</html>